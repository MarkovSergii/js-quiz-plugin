"use strict";function JSQuiz(t){var i=this;this.id=t.id,this.showRequireError=t.showRequireError,this.data=[],Array.isArray(t.data)?this.data=t.data:this.data.push(t.data);var e=function(t){0!=t.data.length&&($(i.id).html(""),t.data.forEach(function(t){t.question&&t.question.id&&t.question.text&&("radiogroup"==t.questionType&&$(i.id).append(a(t)),"checkbox"==t.questionType&&$(i.id).append(r(t)),"text"==t.questionType&&$(i.id).append(n(t)),"select"==t.questionType&&$(i.id).append(s(t)))}))},s=function(t){var e=$("<div></div>");t.question.id&&e.attr("js_qz_id",t.question.id);var s=$("<h3></h3>").text(t.question.text);t.questionClass&&s.addClass(t.questionClass);var n=$("<div></div>"),r=$("<select>").attr("question_id",t.question.id).addClass(t.answerClass).attr("id","select_"+t.question.id);return t.question.answers.forEach(function(t){var i=$("<option></option>").text(t.text).attr("value",t.id);r.append(i)}),r.prop("value",!1),r.change(function(){i.unsetError($(this).attr("question_id"))}),n.append(r),e.append(s),e.append(n),e},n=function(t){var e=$("<div></div>");t.question.id&&e.attr("js_qz_id",t.question.id);var s=$("<h3></h3>").text(t.question.text);t.questionClass&&s.addClass(t.questionClass);var n=$("<div></div>"),r=$("<p></p>").addClass(t.answerClass),a=$("<input>").attr("name","answer_on_question"+t.question.id).attr("question_id",t.question.id).attr("type","text");return a.focus(function(){i.unsetError($(this).attr("question_id"))}),r.prepend(a),n.append(r),e.append(s),e.append(n),e},r=function(t){var e=$("<div></div>");t.question.id&&e.attr("js_qz_id",t.question.id);var s=$("<h3></h3>").text(t.question.text);t.questionClass&&s.addClass(t.questionClass);var n=$("<div></div>");return t.question.answers.forEach(function(e){var s=$("<p></p>").text(e.text).addClass(t.answerClass),r=$("<input>").attr("name","answer_on_question"+t.question.id).attr("question_id",t.question.id).attr("type","checkbox").attr("value",e.id);if(e.other){r.attr("can_other","true");var a=$("<input>").addClass("js_quiz_other_hide").attr("type","text").attr("other_input","true");s.append(a)}r.click(function(){i.unsetError($(this).attr("question_id")),"true"==$(this).attr("can_other")&&$(this).siblings().toggleClass("js_quiz_other_hide")}),s.prepend(r),n.append(s)}),e.append(s),e.append(n),e},a=function(t){var e=$("<div></div>");t.question.id&&e.attr("js_qz_id",t.question.id);var s=$("<h3></h3>").text(t.question.text);t.questionClass&&s.addClass(t.questionClass);var n=$("<div></div>");return t.question.answers.forEach(function(e){var s=$("<p></p>").text(e.text).addClass(t.answerClass),r=$("<input>").attr("name","answer_on_question"+t.question.id).attr("question_id",t.question.id).attr("type","radio").attr("value",e.id);if(e.other){r.attr("can_other","true");var a=$("<input>").addClass("js_quiz_other_hide").attr("type","text").attr("other_input","true");s.append(a)}r.click(function(){i.unsetError($(this).attr("question_id")),"true"==$(this).attr("can_other")?$(this).siblings().removeClass("js_quiz_other_hide"):$("div[js_qz_id="+t.question.id+"]").find('input[other_input="true"]').addClass("js_quiz_other_hide")}),s.prepend(r),n.append(s)}),e.append(s),e.append(n),e},u=function(t){$("[js_qz_id = "+t+"]").addClass("js_quiz_question_error_required")};this.getValues=function(){var t=!1,e=[],s=[];return this.data.forEach(function(i){if("radiogroup"==i.questionType){var n=$("input:radio[name=answer_on_question"+i.question.id+"]:checked"),r=n.val();if(void 0==r)i.required?(s.push(i.question.id),t=!0):e.push({question_id:i.question.id,answers:[{}]});else if("true"==n.attr("can_other")){var a=n.siblings().val();e.push({question_id:i.question.id,answers:[{id:r,other:a}]})}else e.push({question_id:i.question.id,answers:[{id:r}]})}if("checkbox"==i.questionType){var u=$("input[name=answer_on_question"+i.question.id+"]:checked");if(0==u.length)i.required?(s.push(i.question.id),t=!0):e.push({question_id:i.question.id,answers:[""]});else{var o=[];u.each(function(){if("true"==$(this).attr("can_other")){var t=$(this).siblings().val();o.push({id:$(this).val(),other:t})}else o.push({id:$(this).val()})}),e.push({question_id:i.question.id,answers:o})}}if("text"==i.questionType){var d=$("input:text[name=answer_on_question"+i.question.id+"]").val();0==d.length?i.required?(s.push(i.question.id),t=!0):e.push({question_id:i.question.id,answers:[""]}):e.push({question_id:i.question.id,answers:[{text:d}]})}if("select"==i.questionType){var q=$("#select_"+i.question.id+" :selected").val();void 0==q?i.required?(s.push(i.question.id),t=!0):e.push({question_id:i.question.id,answers:[""]}):e.push({question_id:i.question.id,answers:[{id:q}]})}}),i.showRequireError&&s.forEach(function(t){u(t)}),{error:t,data:t?{}:e,errors_id:t?s:[]}},e(this)}!function(t){t.fn.createQuiz=function(t){t=t||{};var i={data:t.data||[],showRequireError:!(!t.showRequireError&&void 0!=t.showRequireError),id:void 0};if(this.selector&&"#"!=!this.selector[0])return i.id=this.selector,new JSQuiz(i)}}(jQuery);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzLXF1aXotcGx1Z2luLmpzIl0sIm5hbWVzIjpbIkpTUXVpeiIsImNvbmZpZyIsInRoYXQiLCJ0aGlzIiwiaWQiLCJzaG93UmVxdWlyZUVycm9yIiwiZGF0YSIsIkFycmF5IiwiaXNBcnJheSIsInB1c2giLCJydW4iLCJpdCIsImxlbmd0aCIsIiQiLCJodG1sIiwiZm9yRWFjaCIsIml0ZW0iLCJxdWVzdGlvbiIsInF1ZXN0aW9uVHlwZSIsImFwcGVuZCIsImNyZWF0ZVJhZGlvR3JvdXAiLCJjcmVhdGVDaGVja0JveCIsImNyZWF0ZVRleHQiLCJjcmVhdGVTZWxlY3QiLCJkaXZfaXRlbSIsImF0dHIiLCJoZWFkZXIiLCJ0ZXh0IiwicXVlc3Rpb25DbGFzcyIsImFkZENsYXNzIiwiY29udGVudCIsInNlbGVjdCIsImFuc3dlckNsYXNzIiwiYW5zd2VycyIsImFuc3dlciIsIm8iLCJwcm9wIiwiY2hhbmdlIiwidW5zZXRFcnJvciIsInAiLCJ0IiwiZm9jdXMiLCJwcmVwZW5kIiwiYyIsIm90aGVyIiwidHh0IiwiY2xpY2siLCJzaWJsaW5ncyIsInRvZ2dsZUNsYXNzIiwiciIsInJlbW92ZUNsYXNzIiwiZmluZCIsInNldEVycm9yIiwiZ2V0VmFsdWVzIiwiaXNfZXJyb3IiLCJlcnJfbWFzX2lkIiwic2VsX2VsZW0iLCJ2YWwiLCJ1bmRlZmluZWQiLCJyZXF1aXJlZCIsInF1ZXN0aW9uX2lkIiwicmVzIiwiZWFjaCIsInMiLCJlcnJvciIsImVycm9yc19pZCIsImZuIiwiY3JlYXRlUXVpeiIsImNvbmYiLCJzZWxlY3RvciIsImpRdWVyeSJdLCJtYXBwaW5ncyI6IkFBR0EsWUFFQSxTQUFBQSxRQUFBQyxHQUVBLEdBQUFDLEdBQUFDLElBRUFBLE1BQUFDLEdBQUFILEVBQUFHLEdBQ0FELEtBQUFFLGlCQUFBSixFQUFBSSxpQkFFQUYsS0FBQUcsUUFDQUMsTUFBQUMsUUFBQVAsRUFBQUssTUFDQUgsS0FBQUcsS0FBQUwsRUFBQUssS0FHQUgsS0FBQUcsS0FBQUcs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TUFBQW1ELFlBQUE1QyxFQUFBQyxTQUFBYixHQUFBNkIsVUFBQTdCLEdBQUEyRCxTQU9BN0QsRUFBQUcsa0JBQ0FrRCxFQUFBeEMsUUFBQSxTQUFBQyxHQUNBb0MsRUFBQXBDLE1BTUFnRCxNQUFBVixFQUNBaEQsS0FBQWdELEtBQUFoRCxFQUNBMkQsVUFBQVgsRUFBQUMsT0FLQTdDLEVBQUFQLE9BSUEsU0FBQVUsR0FDQUEsRUFBQXFELEdBQUFDLFdBQUEsU0FBQWxFLEdBQ0FBLEVBQUFBLEtBRUEsSUFBQW1FLElBQ0E5RCxLQUFBTCxFQUFBSyxTQUNBRCxvQkFBQUosRUFBQUksa0JBQUFxRCxRQUFBekQsRUFBQUksa0JBQ0FELEdBQUFzRCxPQUtBLElBQUF2RCxLQUFBa0UsVUFBQSxNQUFBbEUsS0FBQWtFLFNBQUEsR0FLQSxNQUZBRCxHQUFBaEUsR0FBQUQsS0FBQWtFLFNBRUEsR0FBQXJFLFFBQUFvRSxLQUVBRSIsImZpbGUiOiJqcy1xdWl6LXBsdWdpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSB1c2VyIG9uIDI4LjA2LjIwMTYuXHJcbiAqL1xyXG4ndXNlIHN0cmljdCc7XHJcblxyXG5mdW5jdGlvbiBKU1F1aXooY29uZmlnKSB7XHJcblxyXG4gICAgdmFyIHRoYXQgPSB0aGlzO1xyXG4gICAgLy8gY29uZmlndXJhdGlvblxyXG4gICAgdGhpcy5pZCA9IGNvbmZpZy5pZDtcclxuICAgIHRoaXMuc2hvd1JlcXVpcmVFcnJvciA9IGNvbmZpZy5zaG93UmVxdWlyZUVycm9yO1xyXG5cclxuICAgIHRoaXMuZGF0YSA9IFtdO1xyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlnLmRhdGEpKSB7XHJcbiAgICAgICAgdGhpcy5kYXRhID0gY29uZmlnLmRhdGE7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICB0aGlzLmRhdGEucHVzaChjb25maWcuZGF0YSlcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8gc3lzdGVtIG1ldGhvZHMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAgIC8vIGNyZWF0ZSBxdWl6IGJsb2NrIHNlbGVjdFxyXG4gICAgdmFyIHJ1biA9IGZ1bmN0aW9uIChpdCkge1xyXG4gICAgICAgIGlmIChpdC5kYXRhLmxlbmd0aCAhPSAwKSB7XHJcbiAgICAgICAgICAgICQodGhhdC5pZCkuaHRtbChcIlwiKTtcclxuICAgICAgICAgICAgaXQuZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKGl0ZW0ucXVlc3Rpb24pICYmIChpdGVtLnF1ZXN0aW9uLmlkKSAmJiAoaXRlbS5xdWVzdGlvbi50ZXh0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnF1ZXN0aW9uVHlwZSA9PSAncmFkaW9ncm91cCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGF0LmlkKS5hcHBlbmQoY3JlYXRlUmFkaW9Hcm91cChpdGVtKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnF1ZXN0aW9uVHlwZSA9PSAnY2hlY2tib3gnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhhdC5pZCkuYXBwZW5kKGNyZWF0ZUNoZWNrQm94KGl0ZW0pKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0ucXVlc3Rpb25UeXBlID09ICd0ZXh0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoYXQuaWQpLmFwcGVuZChjcmVhdGVUZXh0KGl0ZW0pKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0ucXVlc3Rpb25UeXBlID09ICdzZWxlY3QnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhhdC5pZCkuYXBwZW5kKGNyZWF0ZVNlbGVjdChpdGVtKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBjcmVhdGVTZWxlY3QgPSBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgIC8vIGNyZWF0ZSByb290IGRpdlxyXG4gICAgICAgIHZhciBkaXZfaXRlbSA9ICQoJzxkaXY+PC9kaXY+Jyk7XHJcbiAgICAgICAgaWYgKGl0ZW0ucXVlc3Rpb24uaWQpIGRpdl9pdGVtLmF0dHIoJ2pzX3F6X2lkJywgaXRlbS5xdWVzdGlvbi5pZCk7XHJcbiAgICAgICAgLy8gY3JlYXRlIGhlYWRlclxyXG4gICAgICAgIHZhciBoZWFkZXIgPSAkKCc8aDM+PC9oMz4nKS50ZXh0KGl0ZW0ucXVlc3Rpb24udGV4dCk7XHJcbiAgICAgICAgaWYgKGl0ZW0ucXVlc3Rpb25DbGFzcykgaGVhZGVyLmFkZENsYXNzKGl0ZW0ucXVlc3Rpb25DbGFzcyk7XHJcbiAgICAgICAgLy8gY3JlYXRlIHNlbGVjdFxyXG4gICAgICAgIHZhciBjb250ZW50ID0gJCgnPGRpdj48L2Rpdj4nKTtcclxuICAgICAgICB2YXIgc2VsZWN0ID0gJCgnPHNlbGVjdD4nKS5hdHRyKCdxdWVzdGlvbl9pZCcsIGl0ZW0ucXVlc3Rpb24uaWQpLmFkZENsYXNzKGl0ZW0uYW5zd2VyQ2xhc3MpLmF0dHIoJ2lkJywgJ3NlbGVjdF8nICsgaXRlbS5xdWVzdGlvbi5pZCk7XHJcbiAgICAgICAgaXRlbS5xdWVzdGlvbi5hbnN3ZXJzLmZvckVhY2goZnVuY3Rpb24gKGFuc3dlcikge1xyXG4gICAgICAgICAgICB2YXIgbyA9ICQoJzxvcHRpb24+PC9vcHRpb24+JykudGV4dChhbnN3ZXIudGV4dCkuYXR0cigndmFsdWUnLCBhbnN3ZXIuaWQpO1xyXG4gICAgICAgICAgICBzZWxlY3QuYXBwZW5kKG8pO1xyXG5cclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBjbGVhciBzZWxlY3RcclxuICAgICAgICBzZWxlY3QucHJvcCgndmFsdWUnLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIC8vIGRlbGV0ZSBlcnJvciBjbGFzcyBpbiB3ZSBjaGFuZ2UgdmFsdWVcclxuICAgICAgICBzZWxlY3QuY2hhbmdlKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdGhhdC51bnNldEVycm9yKCQodGhpcykuYXR0cigncXVlc3Rpb25faWQnKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gY29ubmVjdCBhbGwgdG8gcm9vdCBkaXZcclxuICAgICAgICBjb250ZW50LmFwcGVuZChzZWxlY3QpO1xyXG4gICAgICAgIGRpdl9pdGVtLmFwcGVuZChoZWFkZXIpO1xyXG4gICAgICAgIGRpdl9pdGVtLmFwcGVuZChjb250ZW50KTtcclxuICAgICAgICAvLyByZXR1cm4gc2VsZWN0IGJsb2NrXHJcbiAgICAgICAgcmV0dXJuIGRpdl9pdGVtXHJcblxyXG4gICAgfTtcclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICAvLyBjcmVhdGUgcXVpeiBibG9jayBpbnB1dCB0ZXh0XHJcbiAgICB2YXIgY3JlYXRlVGV4dCA9IGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgLy8gY3JlYXRlIHJvb3QgZGl2XHJcbiAgICAgICAgdmFyIGRpdl9pdGVtID0gJCgnPGRpdj48L2Rpdj4nKTtcclxuICAgICAgICBpZiAoaXRlbS5xdWVzdGlvbi5pZCkgZGl2X2l0ZW0uYXR0cignanNfcXpfaWQnLCBpdGVtLnF1ZXN0aW9uLmlkKTtcclxuICAgICAgICAvLyBjcmVhdGUgaGVhZGVyXHJcbiAgICAgICAgdmFyIGhlYWRlciA9ICQoJzxoMz48L2gzPicpLnRleHQoaXRlbS5xdWVzdGlvbi50ZXh0KTtcclxuICAgICAgICBpZiAoaXRlbS5xdWVzdGlvbkNsYXNzKSBoZWFkZXIuYWRkQ2xhc3MoaXRlbS5xdWVzdGlvbkNsYXNzKTtcclxuICAgICAgICAvLyBjcmVhdGUgaW5wdXRcclxuICAgICAgICB2YXIgY29udGVudCA9ICQoJzxkaXY+PC9kaXY+Jyk7XHJcbiAgICAgICAgdmFyIHAgPSAkKCc8cD48L3A+JykuYWRkQ2xhc3MoaXRlbS5hbnN3ZXJDbGFzcyk7XHJcbiAgICAgICAgdmFyIHQgPSAkKCc8aW5wdXQ+JykuYXR0cignbmFtZScsICdhbnN3ZXJfb25fcXVlc3Rpb24nICsgaXRlbS5xdWVzdGlvbi5pZCkuYXR0cigncXVlc3Rpb25faWQnLCBpdGVtLnF1ZXN0aW9uLmlkKS5hdHRyKCd0eXBlJywgJ3RleHQnKTtcclxuICAgICAgICAvLyBkZWxldGUgZXJyb3IgY2xhc3MgaW4gd2UgY2hhbmdlIHZhbHVlXHJcbiAgICAgICAgdC5mb2N1cyhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRoYXQudW5zZXRFcnJvcigkKHRoaXMpLmF0dHIoJ3F1ZXN0aW9uX2lkJykpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIGNvbm5lY3QgYWxsIHRvIHJvb3QgZGl2XHJcbiAgICAgICAgcC5wcmVwZW5kKHQpO1xyXG4gICAgICAgIGNvbnRlbnQuYXBwZW5kKHApO1xyXG4gICAgICAgIGRpdl9pdGVtLmFwcGVuZChoZWFkZXIpO1xyXG4gICAgICAgIGRpdl9pdGVtLmFwcGVuZChjb250ZW50KTtcclxuICAgICAgICAvLyByZXR1cm4gaW5wdXQgYmxvY2tcclxuICAgICAgICByZXR1cm4gZGl2X2l0ZW1cclxuXHJcbiAgICB9O1xyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAgIC8vIGNyZWF0ZSBxdWl6IGJsb2NrIGNoZWtib3ggZ3JvdXBcclxuICAgIHZhciBjcmVhdGVDaGVja0JveCA9IGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgLy8gY3JlYXRlIHJvb3QgZGl2XHJcbiAgICAgICAgdmFyIGRpdl9pdGVtID0gJCgnPGRpdj48L2Rpdj4nKTtcclxuICAgICAgICBpZiAoaXRlbS5xdWVzdGlvbi5pZCkgZGl2X2l0ZW0uYXR0cignanNfcXpfaWQnLCBpdGVtLnF1ZXN0aW9uLmlkKTtcclxuICAgICAgICAvLyBjcmVhdGUgaGVhZGVyXHJcbiAgICAgICAgdmFyIGhlYWRlciA9ICQoJzxoMz48L2gzPicpLnRleHQoaXRlbS5xdWVzdGlvbi50ZXh0KTtcclxuICAgICAgICBpZiAoaXRlbS5xdWVzdGlvbkNsYXNzKSBoZWFkZXIuYWRkQ2xhc3MoaXRlbS5xdWVzdGlvbkNsYXNzKTtcclxuICAgICAgICAvLyBjcmVhdGUgaW5wdXQgcm9vdFxyXG4gICAgICAgIHZhciBjb250ZW50ID0gJCgnPGRpdj48L2Rpdj4nKTtcclxuXHJcbiAgICAgICAgLy8gY3JlYXRlIGNoYWNrYm94cyBmb3IgZWFjaCBhbnN3ZXJcclxuICAgICAgICBpdGVtLnF1ZXN0aW9uLmFuc3dlcnMuZm9yRWFjaChmdW5jdGlvbiAoYW5zd2VyKSB7XHJcbiAgICAgICAgICAgIHZhciBwID0gJCgnPHA+PC9wPicpLnRleHQoYW5zd2VyLnRleHQpLmFkZENsYXNzKGl0ZW0uYW5zd2VyQ2xhc3MpO1xyXG4gICAgICAgICAgICB2YXIgYyA9ICQoJzxpbnB1dD4nKS5hdHRyKCduYW1lJywgJ2Fuc3dlcl9vbl9xdWVzdGlvbicgKyBpdGVtLnF1ZXN0aW9uLmlkKS5hdHRyKCdxdWVzdGlvbl9pZCcsIGl0ZW0ucXVlc3Rpb24uaWQpLmF0dHIoJ3R5cGUnLCAnY2hlY2tib3gnKS5hdHRyKCd2YWx1ZScsIGFuc3dlci5pZCk7XHJcbiAgICAgICAgICAgIC8vIGlmIHdlIGhhdmUgY2hlY2tib3ggZm9yIG90aGVyIGFkZCBvdGhlciBpbnB1dFxyXG4gICAgICAgICAgICBpZiAoYW5zd2VyLm90aGVyKSB7XHJcbiAgICAgICAgICAgICAgICBjLmF0dHIoJ2Nhbl9vdGhlcicsICd0cnVlJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdHh0ID0gJCgnPGlucHV0PicpLmFkZENsYXNzKCdqc19xdWl6X290aGVyX2hpZGUnKS5hdHRyKCd0eXBlJywgJ3RleHQnKS5hdHRyKFwib3RoZXJfaW5wdXRcIiwgXCJ0cnVlXCIpO1xyXG4gICAgICAgICAgICAgICAgcC5hcHBlbmQodHh0KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYy5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBkZWxldGUgZXJyb3IgY2xhc3MgaW4gd2UgY2hhbmdlIHZhbHVlXHJcbiAgICAgICAgICAgICAgICB0aGF0LnVuc2V0RXJyb3IoJCh0aGlzKS5hdHRyKCdxdWVzdGlvbl9pZCcpKTtcclxuICAgICAgICAgICAgICAgIC8vIGlmIGNoZWNrICBjaGVja2JveCB3aXRoIG90aGVyIGF0dHIgc2hvdyBvdGhlciBpbnB1dFxyXG4gICAgICAgICAgICAgICAgaWYgKCQodGhpcykuYXR0cignY2FuX290aGVyJykgPT0gJ3RydWUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdW5jaGVjayBoaWRlICBvdGhlciBpbnB1dFxyXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuc2libGluZ3MoKS50b2dnbGVDbGFzcygnanNfcXVpel9vdGhlcl9oaWRlJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvLyBjb25uZWN0IGFsbCB0byBpbnB1dCByb290XHJcbiAgICAgICAgICAgIHAucHJlcGVuZChjKTtcclxuICAgICAgICAgICAgY29udGVudC5hcHBlbmQocCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gY29ubmVjdCBhbGwgdG8gcm9vdCBkaXZcclxuICAgICAgICBkaXZfaXRlbS5hcHBlbmQoaGVhZGVyKTtcclxuICAgICAgICBkaXZfaXRlbS5hcHBlbmQoY29udGVudCk7XHJcbiAgICAgICAgLy8gcmV0dXJuIGlucHV0IGJsb2NrXHJcbiAgICAgICAgcmV0dXJuIGRpdl9pdGVtXHJcblxyXG4gICAgfTtcclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICB2YXIgY3JlYXRlUmFkaW9Hcm91cCA9IGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgLy8gY3JlYXRlIHJvb3QgZGl2XHJcbiAgICAgICAgdmFyIGRpdl9pdGVtID0gJCgnPGRpdj48L2Rpdj4nKTtcclxuICAgICAgICBpZiAoaXRlbS5xdWVzdGlvbi5pZCkgZGl2X2l0ZW0uYXR0cignanNfcXpfaWQnLCBpdGVtLnF1ZXN0aW9uLmlkKTtcclxuICAgICAgICAvLyBjcmVhdGUgaGVhZGVyXHJcbiAgICAgICAgdmFyIGhlYWRlciA9ICQoJzxoMz48L2gzPicpLnRleHQoaXRlbS5xdWVzdGlvbi50ZXh0KTtcclxuICAgICAgICBpZiAoaXRlbS5xdWVzdGlvbkNsYXNzKSBoZWFkZXIuYWRkQ2xhc3MoaXRlbS5xdWVzdGlvbkNsYXNzKTtcclxuICAgICAgICAvLyBjcmVhdGUgaW5wdXQgcm9vdFxyXG4gICAgICAgIHZhciBjb250ZW50ID0gJCgnPGRpdj48L2Rpdj4nKTtcclxuXHJcbiAgICAgICAgLy8gY3JlYXRlIHJhZGlvIGZvciBlYWNoIGFuc3dlclxyXG4gICAgICAgIGl0ZW0ucXVlc3Rpb24uYW5zd2Vycy5mb3JFYWNoKGZ1bmN0aW9uIChhbnN3ZXIpIHtcclxuICAgICAgICAgICAgdmFyIHAgPSAkKCc8cD48L3A+JykudGV4dChhbnN3ZXIudGV4dCkuYWRkQ2xhc3MoaXRlbS5hbnN3ZXJDbGFzcyk7XHJcbiAgICAgICAgICAgIHZhciByID0gJCgnPGlucHV0PicpLmF0dHIoJ25hbWUnLCAnYW5zd2VyX29uX3F1ZXN0aW9uJyArIGl0ZW0ucXVlc3Rpb24uaWQpLmF0dHIoJ3F1ZXN0aW9uX2lkJywgaXRlbS5xdWVzdGlvbi5pZCkuYXR0cigndHlwZScsICdyYWRpbycpLmF0dHIoJ3ZhbHVlJywgYW5zd2VyLmlkKTtcclxuICAgICAgICAgICAgLy8gaWYgd2UgaGF2ZSBjaGVja2JveCBmb3Igb3RoZXIgYWRkIG90aGVyIGlucHV0XHJcbiAgICAgICAgICAgIGlmIChhbnN3ZXIub3RoZXIpIHtcclxuICAgICAgICAgICAgICAgIHIuYXR0cignY2FuX290aGVyJywgJ3RydWUnKTtcclxuICAgICAgICAgICAgICAgIHZhciB0eHQgPSAkKCc8aW5wdXQ+JykuYWRkQ2xhc3MoJ2pzX3F1aXpfb3RoZXJfaGlkZScpLmF0dHIoJ3R5cGUnLCAndGV4dCcpLmF0dHIoXCJvdGhlcl9pbnB1dFwiLCBcInRydWVcIik7XHJcbiAgICAgICAgICAgICAgICBwLmFwcGVuZCh0eHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHIuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gZGVsZXRlIGVycm9yIGNsYXNzIGluIHdlIGNoYW5nZSB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgdGhhdC51bnNldEVycm9yKCQodGhpcykuYXR0cigncXVlc3Rpb25faWQnKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCQodGhpcykuYXR0cignY2FuX290aGVyJykgPT0gJ3RydWUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgY2hlY2sgIHJhZGlvIHdpdGggb3RoZXIgYXR0ciBzaG93IG90aGVyIGlucHV0XHJcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdqc19xdWl6X290aGVyX2hpZGUnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIGNoZWNrIG90aGVyIHJhZGlvIHNldCB1bmlzaWJsZSBhbGwgb3RoZXIgaW5wdXRzXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnZGl2W2pzX3F6X2lkPScgKyBpdGVtLnF1ZXN0aW9uLmlkICsgJ10nKS5maW5kKCdpbnB1dFtvdGhlcl9pbnB1dD1cInRydWVcIl0nKS5hZGRDbGFzcygnanNfcXVpel9vdGhlcl9oaWRlJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvLyBjb25uZWN0IGFsbCB0byBpbnB1dCByb290XHJcbiAgICAgICAgICAgIHAucHJlcGVuZChyKTtcclxuICAgICAgICAgICAgY29udGVudC5hcHBlbmQocCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGNvbm5lY3QgYWxsIHRvIHJvb3QgZGl2XHJcbiAgICAgICAgZGl2X2l0ZW0uYXBwZW5kKGhlYWRlcik7XHJcbiAgICAgICAgZGl2X2l0ZW0uYXBwZW5kKGNvbnRlbnQpO1xyXG4gICAgICAgIC8vIHJldHVybiBpbnB1dCBibG9ja1xyXG4gICAgICAgIHJldHVybiBkaXZfaXRlbVxyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgc2V0RXJyb3IgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICAkKCdbanNfcXpfaWQgPSAnICsgaWQgKyAnXScpLmFkZENsYXNzKCdqc19xdWl6X3F1ZXN0aW9uX2Vycm9yX3JlcXVpcmVkJyk7XHJcbiAgICB9O1xyXG4gICAgdmFyIHVuc2V0RXJyb3IgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICAkKCdbanNfcXpfaWQgPSAnICsgaWQgKyAnXScpLnJlbW92ZUNsYXNzKCdqc19xdWl6X3F1ZXN0aW9uX2Vycm9yX3JlcXVpcmVkJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgLy8gbWV0aG9kIGZvciByZXR1cm5pbmcgdmFsdWVzIGZyb20gcXVpelxyXG4gICAgdGhpcy5nZXRWYWx1ZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGlzX2Vycm9yID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBbXTtcclxuICAgICAgICB2YXIgZXJyX21hc19pZCA9IFtdO1xyXG5cclxuICAgICAgICB0aGlzLmRhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICBpZiAoaXRlbS5xdWVzdGlvblR5cGUgPT0gJ3JhZGlvZ3JvdXAnKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VsX2VsZW0gPSAkKFwiaW5wdXQ6cmFkaW9bbmFtZT1cIiArIFwiYW5zd2VyX29uX3F1ZXN0aW9uXCIgKyBpdGVtLnF1ZXN0aW9uLmlkICsgXCJdOmNoZWNrZWRcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgciA9IHNlbF9lbGVtLnZhbCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHIgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0ucmVxdWlyZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyX21hc19pZC5wdXNoKGl0ZW0ucXVlc3Rpb24uaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpc19lcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2goe3F1ZXN0aW9uX2lkOiBpdGVtLnF1ZXN0aW9uLmlkLCBhbnN3ZXJzOiBbe31dfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxfZWxlbS5hdHRyKCdjYW5fb3RoZXInKSA9PSAndHJ1ZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG90aGVyID0gc2VsX2VsZW0uc2libGluZ3MoKS52YWwoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKHtxdWVzdGlvbl9pZDogaXRlbS5xdWVzdGlvbi5pZCwgYW5zd2VyczogW3tpZDogciwgb3RoZXI6IG90aGVyfV19KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaCh7cXVlc3Rpb25faWQ6IGl0ZW0ucXVlc3Rpb24uaWQsIGFuc3dlcnM6IFt7aWQ6IHJ9XX0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpdGVtLnF1ZXN0aW9uVHlwZSA9PSAnY2hlY2tib3gnKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYyA9ICQoXCJpbnB1dFtuYW1lPWFuc3dlcl9vbl9xdWVzdGlvblwiICsgaXRlbS5xdWVzdGlvbi5pZCArIFwiXTpjaGVja2VkXCIpOyAgLy8gYXJyYXkgb2YgYW5zd2Vyc1xyXG4gICAgICAgICAgICAgICAgaWYgKGMubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5yZXF1aXJlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJfbWFzX2lkLnB1c2goaXRlbS5xdWVzdGlvbi5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzX2Vycm9yID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaCh7cXVlc3Rpb25faWQ6IGl0ZW0ucXVlc3Rpb24uaWQsIGFuc3dlcnM6IFtcIlwiXX0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBjLmVhY2goZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQodGhpcykuYXR0cignY2FuX290aGVyJykgPT0gJ3RydWUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3RoZXIgPSAkKHRoaXMpLnNpYmxpbmdzKCkudmFsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMucHVzaCh7aWQ6ICQodGhpcykudmFsKCksIG90aGVyOiBvdGhlcn0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnB1c2goe2lkOiAkKHRoaXMpLnZhbCgpfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaCh7cXVlc3Rpb25faWQ6IGl0ZW0ucXVlc3Rpb24uaWQsIGFuc3dlcnM6IHJlc30pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpdGVtLnF1ZXN0aW9uVHlwZSA9PSAndGV4dCcpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0ID0gJChcImlucHV0OnRleHRbbmFtZT1hbnN3ZXJfb25fcXVlc3Rpb25cIiArIGl0ZW0ucXVlc3Rpb24uaWQgKyBcIl1cIikudmFsKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodC5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnJlcXVpcmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycl9tYXNfaWQucHVzaChpdGVtLnF1ZXN0aW9uLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXNfZXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKHtxdWVzdGlvbl9pZDogaXRlbS5xdWVzdGlvbi5pZCwgYW5zd2VyczogW1wiXCJdfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaCh7cXVlc3Rpb25faWQ6IGl0ZW0ucXVlc3Rpb24uaWQsIGFuc3dlcnM6IFt7dGV4dDogdH1dfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGl0ZW0ucXVlc3Rpb25UeXBlID09ICdzZWxlY3QnKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcyA9ICQoJyNzZWxlY3RfJyArIGl0ZW0ucXVlc3Rpb24uaWQgKyAnIDpzZWxlY3RlZCcpLnZhbCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHMgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0ucmVxdWlyZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyX21hc19pZC5wdXNoKGl0ZW0ucXVlc3Rpb24uaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpc19lcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnB1c2goe3F1ZXN0aW9uX2lkOiBpdGVtLnF1ZXN0aW9uLmlkLCBhbnN3ZXJzOiBbXCJcIl19KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKHtxdWVzdGlvbl9pZDogaXRlbS5xdWVzdGlvbi5pZCwgYW5zd2VyczogW3tpZDogc31dfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIC8vIGlmIGdsb2JhbCBzZXR0aW5ncyBzaG93IGVycm9yIGVuYWJsZWQgdGhlbiBzaG93IGl0XHJcbiAgICAgICAgaWYgKHRoYXQuc2hvd1JlcXVpcmVFcnJvcikge1xyXG4gICAgICAgICAgICBlcnJfbWFzX2lkLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHNldEVycm9yKGl0ZW0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIC8vIHJldHVybiByZXN1bHQgb3IgZXJyb3JcclxuICAgICAgICAgICAgZXJyb3I6IGlzX2Vycm9yLFxyXG4gICAgICAgICAgICBkYXRhOiBpc19lcnJvciA/IHt9IDogZGF0YSxcclxuICAgICAgICAgICAgZXJyb3JzX2lkOiBpc19lcnJvciA/IGVycl9tYXNfaWQgOiBbXVxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICBydW4odGhpcyk7XHJcbn1cclxuXHJcblxyXG4oZnVuY3Rpb24gKCQpIHtcclxuICAgICQuZm4uY3JlYXRlUXVpeiA9IGZ1bmN0aW9uIChjb25maWcpIHtcclxuICAgICAgICBjb25maWcgPSBjb25maWcgfHwge307XHJcblxyXG4gICAgICAgIHZhciBjb25mID0ge1xyXG4gICAgICAgICAgICBkYXRhOiBjb25maWcuZGF0YSB8fCBbXSwgIC8vIGFycmF5IG9mIHF1ZXN0aW9uIG9iamVjdHMgb3IgMSBvYmogaWYgMSBxdWVzdGlvblxyXG4gICAgICAgICAgICBzaG93UmVxdWlyZUVycm9yOiAoKCEhY29uZmlnLnNob3dSZXF1aXJlRXJyb3IpIHx8IChjb25maWcuc2hvd1JlcXVpcmVFcnJvciA9PSB1bmRlZmluZWQpKSA/IHRydWUgOiBmYWxzZSxcclxuICAgICAgICAgICAgaWQ6IHVuZGVmaW5lZFxyXG5cclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgaWYgKCghdGhpcy5zZWxlY3RvcikgfHwgKCF0aGlzLnNlbGVjdG9yWzBdID09ICcjJykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25mLmlkID0gdGhpcy5zZWxlY3RvcjtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBKU1F1aXooY29uZik7XHJcbiAgICB9O1xyXG59KShqUXVlcnkpO1xyXG5cclxuXHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
